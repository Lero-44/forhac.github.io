<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KidsCode Academy - –õ–∞–±–∏—Ä–∏–Ω—Ç</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet">
</head>
<body>
    <header class="platform-header">
        <h1>KidsCode Academy</h1>
        <nav class="main-nav">
            <a href="new3.html" class="nav-item" draggable="false">
                <span class="material-symbols-outlined">home</span>
                –ì–ª–∞–≤–Ω–∞—è
            </a>
            <a href="courses1.html" class="nav-item active" draggable="false">
                <span class="material-symbols-outlined">school</span>
                –ö—É—Ä—Å—ã
            </a>
            <a href="progress.html" class="nav-item" draggable="false">
                <span class="material-symbols-outlined">emoji_events</span>
                –ü—Ä–æ–≥—Ä–µ—Å—Å
            </a>
            <a href="profile.html" class="nav-item" draggable="false">
                <span class="material-symbols-outlined">person</span>
                –ü—Ä–æ—Ñ–∏–ª—å
            </a>
        </nav>
    </header>

    <div class="container">
        <main class="lesson-content">
            <div class="progress-indicator">
                <div class="progress-step completed">–¢–µ–æ—Ä–∏—è</div>
                <div class="progress-step active">–õ–∞–±–∏—Ä–∏–Ω—Ç</div>
                <div class="progress-step">–î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ</div>
            </div>

            <div class="game-section">
                <h2>–ü—Ä–æ–π–¥–∏ –ª–∞–±–∏—Ä–∏–Ω—Ç üéÆ</h2>
                
                <div class="game-container">
                    <div class="maze-container">
                        <div class="maze-grid" id="maze">
                            <!-- Maze will be generated by JavaScript -->
                        </div>
                        <div class="commands-help">
                            <h4>–ö–æ–º–∞–Ω–¥—ã:</h4>
                            <div class="command"><code>–í–ü–ï–†–ï–î</code></div>
                            <div class="command"><code>–ù–ê–ó–ê–î</code></div>
                            <div class="command"><code>–ù–ê–õ–ï–í–û</code></div>
                            <div class="command"><code>–ù–ê–ü–†–ê–í–û</code></div>
                            <div class="command"><code>–ü–û–í–¢–û–†–ò–¢–¨ [—á–∏—Å–ª–æ]</code></div>
                        </div>
                    </div>

                    <div class="code-editor">
                        <h3>–ù–∞–ø–∏—à–∏ –∞–ª–≥–æ—Ä–∏—Ç–º:</h3>
                        <textarea id="code-input" rows="10" placeholder="–ö–∞–∂–¥–∞—è –∫–æ–º–∞–Ω–¥–∞ —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏..."></textarea>
                        <div class="editor-controls">
                            <button id="run-btn" class="primary-btn">–ó–∞–ø—É—Å—Ç–∏—Ç—å</button>
                            <button id="reset-btn" class="secondary-btn">–°–±—Ä–æ—Å–∏—Ç—å</button>
                        </div>
                        <div id="error-message" class="error-message hidden"></div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        const MAZE_SIZE = 8;
        const MAZE = [
            '########',
            '#S     #',
            '###### #',
            '#      #',
            '#    ###',
            '#      #',
            '#F     #',
            '########'
        ];

        let playerPos = { x: 1, y: 1 };
        let playerDir = 3; // 0: right, 1: down, 2: left, 3: up
        let isAnimating = false;

        function createMaze() {
            const maze = document.getElementById('maze');
            maze.style.gridTemplate = `repeat(${MAZE_SIZE}, 1fr) / repeat(${MAZE_SIZE}, 1fr)`;

            MAZE.forEach((row, y) => {
                [...row].forEach((cell, x) => {
                    const div = document.createElement('div');
                    div.className = 'maze-cell';
                    if (cell === '#') div.classList.add('wall');
                    if (cell === 'F') div.classList.add('finish');
                    maze.appendChild(div);
                });
            });

            updatePlayer();
        }

        function updatePlayer() {
            const cells = document.querySelectorAll('.maze-cell');
            cells.forEach(cell => cell.classList.remove('player', 'player-right', 'player-down', 'player-left', 'player-up'));
            
            const playerCell = cells[playerPos.y * MAZE_SIZE + playerPos.x];
            playerCell.classList.add('player');
            playerCell.classList.add(`player-${['right', 'down', 'left', 'up'][playerDir]}`);
        }

        async function executeCommand(command) {
            if (isAnimating) return;
            isAnimating = true;

            const parts = command.trim().split(' ');
            const cmd = parts[0];

            switch (cmd) {
                case '–í–ü–ï–†–ï–î':
                    let newX = playerPos.x;
                    let newY = playerPos.y;
                    
                    if (playerDir === 3) newY--; // up
                    else if (playerDir === 1) newY++; // down
                    else if (playerDir === 0) newX++; // right
                    else if (playerDir === 2) newX--; // left

                    if (MAZE[newY][newX] !== '#') {
                        playerPos.x = newX;
                        playerPos.y = newY;
                        updatePlayer();
                    }
                    break;

                case '–ù–ê–ó–ê–î':
                    let backX = playerPos.x;
                    let backY = playerPos.y;
                    
                    if (playerDir === 3) backY++; // down when facing up
                    else if (playerDir === 1) backY--; // up when facing down
                    else if (playerDir === 0) backX--; // left when facing right
                    else if (playerDir === 2) backX++; // right when facing left

                    if (MAZE[backY][backX] !== '#') {
                        playerPos.x = backX;
                        playerPos.y = backY;
                        updatePlayer();
                    }
                    break;

                case '–ù–ê–õ–ï–í–û':
                    playerDir = (playerDir + 3) % 4;
                    updatePlayer();
                    break;

                case '–ù–ê–ü–†–ê–í–û':
                    playerDir = (playerDir + 1) % 4;
                    updatePlayer();
                    break;

                case '–ü–û–í–¢–û–†–ò–¢–¨':
                    const count = parseInt(parts[1]);
                    if (isNaN(count)) throw new Error('–ü–æ—Å–ª–µ –ü–û–í–¢–û–†–ò–¢–¨ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —á–∏—Å–ª–æ');
                    for (let i = 0; i < count; i++) {
                        await executeCommand(parts.slice(2).join(' '));
                    }
                    break;
            }

            await new Promise(resolve => setTimeout(resolve, 500));
            isAnimating = false;

            if (MAZE[playerPos.y][playerPos.x] === 'F') {
                localStorage.setItem('algoProgress', '100');
                setTimeout(() => {
                    alert('–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –¢—ã –ø—Ä–æ—à–µ–ª –ª–∞–±–∏—Ä–∏–Ω—Ç!');
                    window.location.href = 'algo-achievement.html';
                }, 500);
            }
        }

        async function runCode() {
            const code = document.getElementById('code-input').value;
            const errorMessage = document.getElementById('error-message');
            
            try {
                const commands = code.split('\n').filter(cmd => cmd.trim());
                for (const command of commands) {
                    await executeCommand(command.trim().toUpperCase());
                }
                errorMessage.classList.add('hidden');
            } catch (error) {
                errorMessage.textContent = error.message;
                errorMessage.classList.remove('hidden');
                resetMaze();
            }
        }

        function resetMaze() {
            playerPos = { x: 1, y: 1 };
            playerDir = 3;
            updatePlayer();
            document.getElementById('error-message').classList.add('hidden');
        }

        document.addEventListener('DOMContentLoaded', function() {
            createMaze();
            
            document.getElementById('run-btn').addEventListener('click', runCode);
            document.getElementById('reset-btn').addEventListener('click', resetMaze);
        });
    </script>
</body>
</html>
